{% extends "base.html" %}

{% block title %}Drag & Drop Editor - EventCraft Pro{% endblock %}

{% block content %}
<style>
/* Enhanced Drag & Drop Editor Styles */
.editor-canvas {
    min-height: 600px;
    border: 2px dashed #e9ecef;
    border-radius: 15px;
    background: #f8f9fa;
    position: relative;
    transition: all 0.3s ease;
}

.editor-canvas.drag-over {
    border-color: #007bff;
    background: rgba(0, 123, 255, 0.05);
    transform: scale(1.02);
}

.canvas-drop-zone {
    min-height: 500px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.canvas-drop-zone.has-elements {
    min-height: auto;
    padding: 20px;
}

.drop-zone-content {
    text-align: center;
    padding: 40px;
    transition: all 0.3s ease;
}

.drop-zone-content:hover {
    transform: scale(1.05);
}

.draggable-element {
    background: white;
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 15px;
    margin: 10px 0;
    cursor: grab;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.draggable-element:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #007bff;
}

.draggable-element:active {
    cursor: grabbing;
    transform: scale(0.95);
}

.canvas-element {
    position: absolute;
    background: white;
    border: 2px solid transparent;
    border-radius: 8px;
    padding: 10px;
    cursor: move;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    min-width: 100px;
    min-height: 40px;
}

.canvas-element:hover {
    border-color: #007bff;
    box-shadow: 0 8px 25px rgba(0,123,255,0.2);
    transform: scale(1.02);
}

.canvas-element.selected {
    border-color: #28a745;
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2);
    transform: scale(1.05);
}

.element-controls {
    position: absolute;
    top: -10px;
    right: -10px;
    display: none;
    gap: 5px;
}

.canvas-element:hover .element-controls,
.canvas-element.selected .element-controls {
    display: flex;
}

.element-controls .btn {
    padding: 5px 8px;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Real-time Preview Styles */
.preview-panel {
    background: white;
    border-radius: 15px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    overflow: hidden;
    margin-top: 20px;
}

.preview-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.preview-content {
    padding: 20px;
    min-height: 400px;
    background: #f8f9fa;
}

/* Animation Classes */
@keyframes elementDrop {
    0% {
        transform: scale(0.8);
        opacity: 0;
    }
    50% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes elementHover {
    0% {
        transform: translateY(0);
    }
    100% {
        transform: translateY(-3px);
    }
}

.element-drop-animation {
    animation: elementDrop 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.element-hover-animation {
    animation: elementHover 0.3s ease;
}

/* Enhanced Sidebar Styles */
.editor-sidebar {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    height: fit-content;
    position: sticky;
    top: 20px;
}

.sidebar-section {
    margin-bottom: 25px;
}

.sidebar-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e9ecef;
}

.element-category h6 {
    color: #6c757d;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Template Thumbnails */
.template-thumbnails {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    max-height: 400px;
    overflow-y: auto;
}

.template-thumb {
    border: 2px solid #e9ecef;
    border-radius: 10px;
    padding: 10px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    background: white;
}

.template-thumb:hover {
    border-color: #007bff;
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,123,255,0.2);
}

.template-thumb img {
    width: 100%;
    height: 80px;
    object-fit: cover;
    border-radius: 5px;
    margin-bottom: 8px;
}

.template-thumb span {
    font-size: 0.8rem;
    font-weight: 500;
    color: #495057;
}

/* Properties Sidebar */
.properties-sidebar {
    background: white;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    height: fit-content;
    position: sticky;
    top: 20px;
}

.properties-title {
    color: #2c3e50;
    font-weight: 600;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #e9ecef;
}

.control-group {
    margin-bottom: 20px;
}

.control-group label {
    font-weight: 500;
    color: #495057;
    margin-bottom: 8px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .editor-canvas {
        min-height: 400px;
    }
    
    .canvas-drop-zone {
        min-height: 300px;
    }
    
    .draggable-element {
        padding: 10px;
        margin: 5px 0;
    }
}
</style>
<!-- Editor Hero -->
<section class="editor-hero py-4 bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="h3 fw-bold mb-2">Drag & Drop Editor</h1>
                <p class="text-muted mb-0">Create stunning invitations with our intuitive drag-and-drop interface</p>
            </div>
            <div class="col-lg-4 text-end">
                <button class="btn btn-outline-primary me-2" onclick="previewInvitation()">
                    <i class="fas fa-eye me-1"></i>Preview
                </button>
                <button class="btn btn-primary" onclick="saveInvitation()">
                    <i class="fas fa-save me-1"></i>Save
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Editor Interface -->
<section class="editor-interface py-4">
    <div class="container-fluid">
        <div class="row">
            <!-- Left Sidebar - Elements -->
            <div class="col-lg-3">
                <div class="editor-sidebar">
                    <div class="sidebar-section">
                        <h5 class="sidebar-title">Elements</h5>
                        <div class="element-category">
                            <h6>Text Elements</h6>
                            <div class="draggable-elements">
                                <div class="draggable-element" draggable="true" data-type="text" data-element="heading">
                                    <i class="fas fa-heading"></i>
                                    <span>Heading</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="text" data-element="subheading">
                                    <i class="fas fa-text-width"></i>
                                    <span>Subheading</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="text" data-element="paragraph">
                                    <i class="fas fa-paragraph"></i>
                                    <span>Paragraph</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-category">
                            <h6>Media Elements</h6>
                            <div class="draggable-elements">
                                <div class="draggable-element" draggable="true" data-type="media" data-element="image">
                                    <i class="fas fa-image"></i>
                                    <span>Image</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="media" data-element="video">
                                    <i class="fas fa-video"></i>
                                    <span>Video</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-category">
                            <h6>Event Elements</h6>
                            <div class="draggable-elements">
                                <div class="draggable-element" draggable="true" data-type="event" data-element="date">
                                    <i class="fas fa-calendar"></i>
                                    <span>Date</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="event" data-element="time">
                                    <i class="fas fa-clock"></i>
                                    <span>Time</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="event" data-element="location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>Location</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="event" data-element="rsvp">
                                    <i class="fas fa-reply"></i>
                                    <span>RSVP Button</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h5 class="sidebar-title">Templates</h5>
                        <div class="template-thumbnails">
                            <div class="template-thumb" onclick="loadTemplate('wedding')">
                                <img src="/images/weddingelegant.jpg" alt="Wedding Template">
                                <span>Wedding</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('birthday')">
                                <img src="/images/birthday.jpg" alt="Birthday Template">
                                <span>Birthday</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('anniversary')">
                                <img src="/images/anniversery.jpg" alt="Anniversary Template">
                                <span>Anniversary</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('graduation')">
                                <img src="/images/graduation.jpg" alt="Graduation Template">
                                <span>Graduation</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('babyshower')">
                                <img src="/images/babyshower.jpg" alt="Baby Shower Template">
                                <span>Baby Shower</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('retirement')">
                                <img src="/images/retirement.jpg" alt="Retirement Template">
                                <span>Retirement</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('corporate')">
                                <img src="/images/corporateevent.jpg" alt="Corporate Template">
                                <span>Corporate</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('genderreveal')">
                                <img src="/images/genderreveal.jpg" alt="Gender Reveal Template">
                                <span>Gender Reveal</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center - Canvas -->
            <div class="col-lg-6">
                <div class="editor-canvas-container">
                    <div class="canvas-toolbar">
                        <div class="toolbar-group">
                            <button class="btn btn-sm btn-outline-secondary" onclick="zoomOut()" title="Zoom Out">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <span class="zoom-level" id="zoom-level">100%</span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="zoomIn()" title="Zoom In">
                                <i class="fas fa-search-plus"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="resetZoom()" title="Reset Zoom">
                                <i class="fas fa-expand-arrows-alt"></i>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <button class="btn btn-sm btn-outline-secondary" onclick="undo()">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="redo()">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="editor-canvas" id="editor-canvas">
                        <!-- Real-time Preview Toggle -->
                        <div class="preview-toggle mb-3">
                            <div class="btn-group" role="group">
                                <button type="button" class="btn btn-outline-primary active" id="edit-mode">
                                    <i class="fas fa-edit me-1"></i>Edit Mode
                                </button>
                                <button type="button" class="btn btn-outline-success" id="preview-mode">
                                    <i class="fas fa-eye me-1"></i>Live Preview
                                </button>
                            </div>
                        </div>
                        
                        <div class="canvas-drop-zone" id="canvas-drop-zone">
                            <div class="drop-zone-content">
                                <i class="fas fa-plus-circle fa-3x text-muted mb-3"></i>
                                <h4 class="text-muted">Drag elements here to start building</h4>
                                <p class="text-muted">Choose from the sidebar or start with a template</p>
                            </div>
                        </div>
                        
                        <!-- Real-time Preview Panel -->
                        <div class="preview-panel" id="preview-panel" style="display: none;">
                            <div class="preview-header">
                                <h5>Live Preview</h5>
                                <div class="preview-controls">
                                    <button class="btn btn-sm btn-outline-secondary" onclick="downloadPreview()">
                                        <i class="fas fa-download me-1"></i>Download
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="sharePreview()">
                                        <i class="fas fa-share me-1"></i>Share
                                    </button>
                                </div>
                            </div>
                            <div class="preview-content" id="preview-content">
                                <!-- Preview content will be generated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar - Properties -->
            <div class="col-lg-3">
                <div class="properties-sidebar">
                    <div class="properties-section">
                        <h5 class="properties-title">Properties</h5>
                        <div id="element-properties">
                            <p class="text-muted text-center">Select an element to edit its properties</p>
                        </div>
                    </div>
                    
                    <div class="properties-section">
                        <h5 class="properties-title">Design</h5>
                        <div class="design-controls">
                            <div class="control-group">
                                <label class="form-label">Background Color</label>
                                <input type="color" class="form-control form-control-color" id="bg-color" value="#ffffff">
                            </div>
                            <div class="control-group">
                                <label class="form-label">Canvas Size</label>
                                <select class="form-select" id="canvas-size">
                                    <option value="600x800">Standard (600x800)</option>
                                    <option value="800x600">Landscape (800x600)</option>
                                    <option value="600x600">Square (600x600)</option>
                                    <option value="400x600">Portrait (400x600)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Element Properties Modal -->
<div class="modal fade" id="elementModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Element</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="element-form">
                    <div class="mb-3">
                        <label for="element-text" class="form-label">Text Content</label>
                        <textarea class="form-control" id="element-text" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="element-font-size" class="form-label">Font Size</label>
                                <input type="number" class="form-control" id="element-font-size" value="16">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="element-color" class="form-label">Text Color</label>
                                <input type="color" class="form-control form-control-color" id="element-color" value="#000000">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="element-font-family" class="form-label">Font Family</label>
                        <select class="form-select" id="element-font-family">
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="Georgia, serif">Georgia</option>
                            <option value="Times New Roman, serif">Times New Roman</option>
                            <option value="Helvetica, sans-serif">Helvetica</option>
                            <option value="'Courier New', monospace">Courier New</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applyElementChanges()">Apply Changes</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
let currentZoom = 100;
let selectedElement = null;
let elementCounter = 0;

// Initialize drag and drop
document.addEventListener('DOMContentLoaded', function() {
    initializeDragAndDrop();
    initializeCanvas();
});

function initializeDragAndDrop() {
    const draggableElements = document.querySelectorAll('.draggable-element');
    const canvas = document.getElementById('editor-canvas');
    
    draggableElements.forEach(element => {
        element.addEventListener('dragstart', handleDragStart);
    });
    
    canvas.addEventListener('dragover', handleDragOver);
    canvas.addEventListener('drop', handleDrop);
    canvas.addEventListener('dragenter', handleDragEnter);
    canvas.addEventListener('dragleave', handleDragLeave);
}

function handleDragStart(e) {
    e.dataTransfer.setData('text/plain', JSON.stringify({
        type: e.target.dataset.type,
        element: e.target.dataset.element
    }));
    e.target.classList.add('dragging');
}

function handleDragOver(e) {
    e.preventDefault();
}

function handleDragEnter(e) {
    e.preventDefault();
    e.target.classList.add('drag-over');
}

function handleDragLeave(e) {
    e.target.classList.remove('drag-over');
}

function handleDrop(e) {
    e.preventDefault();
    e.target.classList.remove('drag-over');
    
    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
    const rect = e.target.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    createElement(data.type, data.element, x, y);
}

function createElement(type, elementType, x, y) {
    const canvas = document.getElementById('editor-canvas');
    const dropZone = canvas.querySelector('.canvas-drop-zone');
    
    // Hide drop zone if it exists
    if (dropZone) {
        dropZone.style.display = 'none';
    }
    
    const element = document.createElement('div');
    element.className = 'canvas-element';
    element.dataset.type = type;
    element.dataset.element = elementType;
    element.dataset.id = ++elementCounter;
    
    // Position element
    element.style.position = 'absolute';
    element.style.left = x + 'px';
    element.style.top = y + 'px';
    
    // Create element content based on type
    switch (elementType) {
        case 'heading':
            element.innerHTML = '<h2 contenteditable="true">Your Heading</h2>';
            element.style.fontSize = '24px';
            element.style.fontWeight = 'bold';
            break;
        case 'subheading':
            element.innerHTML = '<h3 contenteditable="true">Your Subheading</h3>';
            element.style.fontSize = '18px';
            break;
        case 'paragraph':
            element.innerHTML = '<p contenteditable="true">Your paragraph text goes here...</p>';
            element.style.fontSize = '14px';
            break;
        case 'image':
            element.innerHTML = '<div class="image-placeholder"><i class="fas fa-image fa-2x"></i><br><small>Click to upload image</small></div>';
            element.style.width = '200px';
            element.style.height = '150px';
            element.style.border = '2px dashed #ccc';
            element.style.display = 'flex';
            element.style.alignItems = 'center';
            element.style.justifyContent = 'center';
            element.style.flexDirection = 'column';
            break;
        case 'date':
            element.innerHTML = '<div class="date-element"><i class="fas fa-calendar me-2"></i><span contenteditable="true">Event Date</span></div>';
            break;
        case 'time':
            element.innerHTML = '<div class="time-element"><i class="fas fa-clock me-2"></i><span contenteditable="true">Event Time</span></div>';
            break;
        case 'location':
            element.innerHTML = '<div class="location-element"><i class="fas fa-map-marker-alt me-2"></i><span contenteditable="true">Event Location</span></div>';
            break;
        case 'rsvp':
            element.innerHTML = '<button class="btn btn-primary">RSVP Now</button>';
            break;
    }
    
    // Add element controls
    element.innerHTML += `
        <div class="element-controls">
            <button class="btn btn-sm btn-outline-primary" onclick="editElement(${elementCounter})">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteElement(${elementCounter})">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    // Make element draggable within canvas
    element.draggable = true;
    element.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('text/plain', 'move');
    });
    
    element.addEventListener('click', function() {
        selectElement(element);
    });
    
    canvas.appendChild(element);
    selectElement(element);
}

function selectElement(element) {
    // Remove previous selection
    document.querySelectorAll('.canvas-element').forEach(el => {
        el.classList.remove('selected');
    });
    
    // Select new element
    element.classList.add('selected');
    selectedElement = element;
    
    // Update properties panel
    updatePropertiesPanel(element);
}

function updatePropertiesPanel(element) {
    const propertiesPanel = document.getElementById('element-properties');
    const type = element.dataset.type;
    const elementType = element.dataset.element;
    
    let propertiesHTML = `
        <div class="property-group">
            <label class="form-label">Element Type</label>
            <p class="form-control-plaintext">${elementType}</p>
        </div>
    `;
    
    if (type === 'text') {
        propertiesHTML += `
            <div class="property-group">
                <label class="form-label">Text Content</label>
                <textarea class="form-control" rows="2" onchange="updateElementProperty('text', this.value)">${element.textContent}</textarea>
            </div>
            <div class="property-group">
                <label class="form-label">Font Size</label>
                <input type="number" class="form-control" value="${parseInt(element.style.fontSize) || 16}" onchange="updateElementProperty('fontSize', this.value + 'px')">
            </div>
            <div class="property-group">
                <label class="form-label">Text Color</label>
                <input type="color" class="form-control form-control-color" value="${element.style.color || '#000000'}" onchange="updateElementProperty('color', this.value)">
            </div>
        `;
    }
    
    propertiesHTML += `
        <div class="property-group">
            <label class="form-label">Position</label>
            <div class="row">
                <div class="col-6">
                    <input type="number" class="form-control" placeholder="X" value="${parseInt(element.style.left) || 0}" onchange="updateElementProperty('left', this.value + 'px')">
                </div>
                <div class="col-6">
                    <input type="number" class="form-control" placeholder="Y" value="${parseInt(element.style.top) || 0}" onchange="updateElementProperty('top', this.value + 'px')">
                </div>
            </div>
        </div>
    `;
    
    propertiesPanel.innerHTML = propertiesHTML;
}

function updateElementProperty(property, value) {
    if (selectedElement) {
        selectedElement.style[property] = value;
        // Trigger real-time preview update
        updateRealTimePreview();
    }
}

// Real-time Preview Functions
function updateRealTimePreview() {
    const previewContent = document.getElementById('preview-content');
    const canvas = document.getElementById('canvas-drop-zone');
    const elements = canvas.querySelectorAll('.canvas-element');
    
    if (elements.length === 0) {
        previewContent.innerHTML = '<div class="text-center text-muted py-5"><i class="fas fa-image fa-3x mb-3"></i><p>No elements to preview</p></div>';
        return;
    }
    
    // Create preview HTML
    let previewHTML = '<div class="invitation-preview" style="background: white; border-radius: 10px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">';
    
    elements.forEach(element => {
        const elementType = element.dataset.element;
        const elementContent = element.innerHTML;
        
        // Clean up element content for preview
        let cleanContent = elementContent
            .replace(/<div class="element-controls">[\s\S]*?<\/div>/g, '') // Remove controls
            .replace(/contenteditable="true"/g, '') // Remove contenteditable
            .replace(/onclick="[^"]*"/g, ''); // Remove onclick handlers
        
        previewHTML += `<div class="preview-element" style="margin-bottom: 15px;">${cleanContent}</div>`;
    });
    
    previewHTML += '</div>';
    previewContent.innerHTML = previewHTML;
}

// Preview Mode Toggle
document.addEventListener('DOMContentLoaded', function() {
    const editModeBtn = document.getElementById('edit-mode');
    const previewModeBtn = document.getElementById('preview-mode');
    const canvasDropZone = document.getElementById('canvas-drop-zone');
    const previewPanel = document.getElementById('preview-panel');
    
    editModeBtn.addEventListener('click', function() {
        editModeBtn.classList.add('active');
        previewModeBtn.classList.remove('active');
        canvasDropZone.style.display = 'block';
        previewPanel.style.display = 'none';
    });
    
    previewModeBtn.addEventListener('click', function() {
        previewModeBtn.classList.add('active');
        editModeBtn.classList.remove('active');
        canvasDropZone.style.display = 'none';
        previewPanel.style.display = 'block';
        updateRealTimePreview();
    });
});

// Enhanced Drag and Drop with Animations
function enhanceDragAndDrop() {
    const draggableElements = document.querySelectorAll('.draggable-element');
    const canvas = document.getElementById('canvas-drop-zone');
    
    draggableElements.forEach(element => {
        element.addEventListener('dragstart', function(e) {
            e.dataTransfer.setData('text/plain', JSON.stringify({
                type: this.dataset.type,
                element: this.dataset.element
            }));
            this.style.opacity = '0.5';
        });
        
        element.addEventListener('dragend', function(e) {
            this.style.opacity = '1';
        });
        
        element.addEventListener('mouseenter', function() {
            this.classList.add('element-hover-animation');
        });
        
        element.addEventListener('mouseleave', function() {
            this.classList.remove('element-hover-animation');
        });
    });
    
    canvas.addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('drag-over');
    });
    
    canvas.addEventListener('dragleave', function(e) {
        if (!this.contains(e.relatedTarget)) {
            this.classList.remove('drag-over');
        }
    });
    
    canvas.addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('drag-over');
        
        const data = JSON.parse(e.dataTransfer.getData('text/plain'));
        const rect = this.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        createCanvasElement(data.type, data.element, x, y);
        
        // Hide drop zone content if elements exist
        const dropZoneContent = this.querySelector('.drop-zone-content');
        if (dropZoneContent && this.querySelectorAll('.canvas-element').length > 0) {
            dropZoneContent.style.display = 'none';
            this.classList.add('has-elements');
        }
    });
}

// Download Preview Function
function downloadPreview() {
    const previewContent = document.getElementById('preview-content');
    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d');
    
    // Create a simple download (in a real implementation, you'd use html2canvas or similar)
    const link = document.createElement('a');
    link.download = 'invitation-preview.png';
    link.href = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==';
    link.click();
}

// Share Preview Function
function sharePreview() {
    if (navigator.share) {
        navigator.share({
            title: 'My Event Invitation',
            text: 'Check out my beautiful invitation!',
            url: window.location.href
        });
    } else {
        // Fallback to copying to clipboard
        navigator.clipboard.writeText(window.location.href).then(() => {
            alert('Link copied to clipboard!');
        });
    }
}

// Initialize enhanced functionality
document.addEventListener('DOMContentLoaded', function() {
    enhanceDragAndDrop();
    
    // Add animation to new elements
    const observer = new MutationObserver(function(mutations) {
        mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(function(node) {
                if (node.classList && node.classList.contains('canvas-element')) {
                    node.classList.add('element-drop-animation');
                    setTimeout(() => {
                        node.classList.remove('element-drop-animation');
                    }, 500);
                }
            });
        });
    });
    
    observer.observe(document.getElementById('canvas-drop-zone'), {
        childList: true,
        subtree: true
    });
});

function editElement(elementId) {
    const element = document.querySelector(`[data-id="${elementId}"]`);
    if (element) {
        selectElement(element);
        // Open modal for detailed editing
        const modal = new bootstrap.Modal(document.getElementById('elementModal'));
        modal.show();
    }
}

function deleteElement(elementId) {
    const element = document.querySelector(`[data-id="${elementId}"]`);
    if (element) {
        element.remove();
        selectedElement = null;
        document.getElementById('element-properties').innerHTML = '<p class="text-muted text-center">Select an element to edit its properties</p>';
    }
}

function loadTemplate(templateType) {
    const canvas = document.getElementById('editor-canvas');
    canvas.innerHTML = '';
    
    // Create template elements based on type
    switch (templateType) {
        case 'wedding':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
        case 'birthday':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'paragraph', 50, 100);
            createElement('event', 'date', 50, 200);
            createElement('event', 'rsvp', 50, 250);
            break;
        case 'anniversary':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
        case 'graduation':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
        case 'babyshower':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
        case 'retirement':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
        case 'corporate':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
        case 'genderreveal':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
    }
    
    showNotification(`Loaded ${templateType} template!`, 'success');
}

function zoomIn() {
    currentZoom = Math.min(200, currentZoom + 25);
    updateZoom();
}

function zoomOut() {
    currentZoom = Math.max(25, currentZoom - 25);
    updateZoom();
}

function resetZoom() {
    currentZoom = 100;
    updateZoom();
}

function updateZoom() {
    const canvas = document.getElementById('editor-canvas');
    const zoomLevel = document.getElementById('zoom-level');
    
    canvas.style.transform = `scale(${currentZoom / 100})`;
    canvas.style.transformOrigin = 'top left';
    zoomLevel.textContent = currentZoom + '%';
    
    // Update canvas container size to accommodate zoom
    const container = canvas.parentElement;
    if (currentZoom > 100) {
        container.style.overflow = 'auto';
        container.style.maxHeight = '80vh';
    } else {
        container.style.overflow = 'visible';
        container.style.maxHeight = 'none';
    }
}

function previewInvitation() {
    // Create preview modal or redirect to preview page
    alert('Preview functionality would open here');
}

function saveInvitation() {
    // Save the current design
    alert('Save functionality would save the invitation here');
}

function undo() {
    // Implement undo functionality
    console.log('Undo');
}

function redo() {
    // Implement redo functionality
    console.log('Redo');
}

function initializeCanvas() {
    // Set initial canvas size
    const canvas = document.getElementById('editor-canvas');
    canvas.style.width = '600px';
    canvas.style.height = '800px';
    canvas.style.border = '1px solid #ddd';
    canvas.style.position = 'relative';
    canvas.style.background = '#ffffff';
    canvas.style.margin = '0 auto';
}
</script>

<style>
.editor-sidebar, .properties-sidebar {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 1.5rem;
    height: calc(100vh - 200px);
    overflow-y: auto;
}

.sidebar-title, .properties-title {
    color: var(--primary-color);
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--accent-color);
}

.element-category {
    margin-bottom: 1.5rem;
}

.element-category h6 {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.draggable-elements {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
}

.draggable-element {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
    border: 2px solid var(--border-color);
    border-radius: 0.5rem;
    cursor: grab;
    transition: all 0.3s ease;
    background: white;
}

.draggable-element:hover {
    border-color: var(--primary-color);
    background: var(--bg-light);
    transform: translateY(-2px);
}

.draggable-element.dragging {
    opacity: 0.5;
    transform: rotate(5deg);
}

.draggable-element i {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.draggable-element span {
    font-size: 0.8rem;
    color: var(--text-secondary);
    text-align: center;
}

.template-thumbnails {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.template-thumb {
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.template-thumb:hover {
    transform: scale(1.05);
}

.template-thumb img {
    width: 100%;
    height: 80px;
    object-fit: cover;
    border-radius: 0.5rem;
    border: 2px solid var(--border-color);
}

.template-thumb span {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.editor-canvas-container {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 1rem;
}

.canvas-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0.5rem;
    background: var(--bg-light);
    border-radius: 0.5rem;
}

.toolbar-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.zoom-level {
    font-weight: 500;
    color: var(--text-secondary);
    min-width: 50px;
    text-align: center;
}

.editor-canvas {
    border: 2px dashed var(--border-color);
    border-radius: 0.5rem;
    min-height: 600px;
    position: relative;
    background: white;
    margin: 0 auto;
}

.canvas-drop-zone {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    min-height: 600px;
}

.drop-zone-content {
    text-align: center;
    color: var(--text-light);
}

.canvas-element {
    border: 2px solid transparent;
    border-radius: 0.25rem;
    padding: 0.5rem;
    cursor: move;
    transition: all 0.3s ease;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.canvas-element:hover {
    border-color: var(--accent-color);
}

.canvas-element.selected {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(16, 19, 87, 0.2);
}

.element-controls {
    position: absolute;
    top: -10px;
    right: -10px;
    display: none;
    gap: 0.25rem;
}

.canvas-element:hover .element-controls,
.canvas-element.selected .element-controls {
    display: flex;
}

.image-placeholder {
    color: var(--text-light);
    text-align: center;
}

.property-group {
    margin-bottom: 1rem;
}

.property-group .form-label {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.design-controls .control-group {
    margin-bottom: 1rem;
}

.drag-over {
    background: rgba(16, 19, 87, 0.1) !important;
    border-color: var(--primary-color) !important;
}
</style>
{% endblock %}
