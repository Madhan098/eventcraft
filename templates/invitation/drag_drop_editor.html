{% extends "base.html" %}

{% block title %}Drag & Drop Editor - EventCraft Pro{% endblock %}

{% block content %}
<!-- Editor Hero -->
<section class="editor-hero py-4 bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="h3 fw-bold mb-2">Drag & Drop Editor</h1>
                <p class="text-muted mb-0">Create stunning invitations with our intuitive drag-and-drop interface</p>
            </div>
            <div class="col-lg-4 text-end">
                <button class="btn btn-outline-primary me-2" onclick="previewInvitation()">
                    <i class="fas fa-eye me-1"></i>Preview
                </button>
                <button class="btn btn-primary" onclick="saveInvitation()">
                    <i class="fas fa-save me-1"></i>Save
                </button>
            </div>
        </div>
    </div>
</section>

<!-- Editor Interface -->
<section class="editor-interface py-4">
    <div class="container-fluid">
        <div class="row">
            <!-- Left Sidebar - Elements -->
            <div class="col-lg-3">
                <div class="editor-sidebar">
                    <div class="sidebar-section">
                        <h5 class="sidebar-title">Elements</h5>
                        <div class="element-category">
                            <h6>Text Elements</h6>
                            <div class="draggable-elements">
                                <div class="draggable-element" draggable="true" data-type="text" data-element="heading">
                                    <i class="fas fa-heading"></i>
                                    <span>Heading</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="text" data-element="subheading">
                                    <i class="fas fa-text-width"></i>
                                    <span>Subheading</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="text" data-element="paragraph">
                                    <i class="fas fa-paragraph"></i>
                                    <span>Paragraph</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-category">
                            <h6>Media Elements</h6>
                            <div class="draggable-elements">
                                <div class="draggable-element" draggable="true" data-type="media" data-element="image">
                                    <i class="fas fa-image"></i>
                                    <span>Image</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="media" data-element="video">
                                    <i class="fas fa-video"></i>
                                    <span>Video</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="element-category">
                            <h6>Event Elements</h6>
                            <div class="draggable-elements">
                                <div class="draggable-element" draggable="true" data-type="event" data-element="date">
                                    <i class="fas fa-calendar"></i>
                                    <span>Date</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="event" data-element="time">
                                    <i class="fas fa-clock"></i>
                                    <span>Time</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="event" data-element="location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    <span>Location</span>
                                </div>
                                <div class="draggable-element" draggable="true" data-type="event" data-element="rsvp">
                                    <i class="fas fa-reply"></i>
                                    <span>RSVP Button</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="sidebar-section">
                        <h5 class="sidebar-title">Templates</h5>
                        <div class="template-thumbnails">
                            <div class="template-thumb" onclick="loadTemplate('wedding')">
                                <img src="/static/images/wedding_elegant_preview.png" alt="Wedding Template">
                                <span>Wedding</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('birthday')">
                                <img src="/static/images/birthday_fun_preview.png" alt="Birthday Template">
                                <span>Birthday</span>
                            </div>
                            <div class="template-thumb" onclick="loadTemplate('anniversary')">
                                <img src="/static/images/anniversary_golden_preview.png" alt="Anniversary Template">
                                <span>Anniversary</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Center - Canvas -->
            <div class="col-lg-6">
                <div class="editor-canvas-container">
                    <div class="canvas-toolbar">
                        <div class="toolbar-group">
                            <button class="btn btn-sm btn-outline-secondary" onclick="zoomOut()">
                                <i class="fas fa-search-minus"></i>
                            </button>
                            <span class="zoom-level">100%</span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="zoomIn()">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                        <div class="toolbar-group">
                            <button class="btn btn-sm btn-outline-secondary" onclick="undo()">
                                <i class="fas fa-undo"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="redo()">
                                <i class="fas fa-redo"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="editor-canvas" id="editor-canvas">
                        <div class="canvas-drop-zone">
                            <div class="drop-zone-content">
                                <i class="fas fa-plus-circle fa-3x text-muted mb-3"></i>
                                <h4 class="text-muted">Drag elements here to start building</h4>
                                <p class="text-muted">Choose from the sidebar or start with a template</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Right Sidebar - Properties -->
            <div class="col-lg-3">
                <div class="properties-sidebar">
                    <div class="properties-section">
                        <h5 class="properties-title">Properties</h5>
                        <div id="element-properties">
                            <p class="text-muted text-center">Select an element to edit its properties</p>
                        </div>
                    </div>
                    
                    <div class="properties-section">
                        <h5 class="properties-title">Design</h5>
                        <div class="design-controls">
                            <div class="control-group">
                                <label class="form-label">Background Color</label>
                                <input type="color" class="form-control form-control-color" id="bg-color" value="#ffffff">
                            </div>
                            <div class="control-group">
                                <label class="form-label">Canvas Size</label>
                                <select class="form-select" id="canvas-size">
                                    <option value="600x800">Standard (600x800)</option>
                                    <option value="800x600">Landscape (800x600)</option>
                                    <option value="600x600">Square (600x600)</option>
                                    <option value="400x600">Portrait (400x600)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Element Properties Modal -->
<div class="modal fade" id="elementModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit Element</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="element-form">
                    <div class="mb-3">
                        <label for="element-text" class="form-label">Text Content</label>
                        <textarea class="form-control" id="element-text" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="element-font-size" class="form-label">Font Size</label>
                                <input type="number" class="form-control" id="element-font-size" value="16">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="element-color" class="form-label">Text Color</label>
                                <input type="color" class="form-control form-control-color" id="element-color" value="#000000">
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="element-font-family" class="form-label">Font Family</label>
                        <select class="form-select" id="element-font-family">
                            <option value="Arial, sans-serif">Arial</option>
                            <option value="Georgia, serif">Georgia</option>
                            <option value="Times New Roman, serif">Times New Roman</option>
                            <option value="Helvetica, sans-serif">Helvetica</option>
                            <option value="'Courier New', monospace">Courier New</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applyElementChanges()">Apply Changes</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
let currentZoom = 100;
let selectedElement = null;
let elementCounter = 0;

// Initialize drag and drop
document.addEventListener('DOMContentLoaded', function() {
    initializeDragAndDrop();
    initializeCanvas();
});

function initializeDragAndDrop() {
    const draggableElements = document.querySelectorAll('.draggable-element');
    const canvas = document.getElementById('editor-canvas');
    
    draggableElements.forEach(element => {
        element.addEventListener('dragstart', handleDragStart);
    });
    
    canvas.addEventListener('dragover', handleDragOver);
    canvas.addEventListener('drop', handleDrop);
    canvas.addEventListener('dragenter', handleDragEnter);
    canvas.addEventListener('dragleave', handleDragLeave);
}

function handleDragStart(e) {
    e.dataTransfer.setData('text/plain', JSON.stringify({
        type: e.target.dataset.type,
        element: e.target.dataset.element
    }));
    e.target.classList.add('dragging');
}

function handleDragOver(e) {
    e.preventDefault();
}

function handleDragEnter(e) {
    e.preventDefault();
    e.target.classList.add('drag-over');
}

function handleDragLeave(e) {
    e.target.classList.remove('drag-over');
}

function handleDrop(e) {
    e.preventDefault();
    e.target.classList.remove('drag-over');
    
    const data = JSON.parse(e.dataTransfer.getData('text/plain'));
    const rect = e.target.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    
    createElement(data.type, data.element, x, y);
}

function createElement(type, elementType, x, y) {
    const canvas = document.getElementById('editor-canvas');
    const dropZone = canvas.querySelector('.canvas-drop-zone');
    
    // Hide drop zone if it exists
    if (dropZone) {
        dropZone.style.display = 'none';
    }
    
    const element = document.createElement('div');
    element.className = 'canvas-element';
    element.dataset.type = type;
    element.dataset.element = elementType;
    element.dataset.id = ++elementCounter;
    
    // Position element
    element.style.position = 'absolute';
    element.style.left = x + 'px';
    element.style.top = y + 'px';
    
    // Create element content based on type
    switch (elementType) {
        case 'heading':
            element.innerHTML = '<h2 contenteditable="true">Your Heading</h2>';
            element.style.fontSize = '24px';
            element.style.fontWeight = 'bold';
            break;
        case 'subheading':
            element.innerHTML = '<h3 contenteditable="true">Your Subheading</h3>';
            element.style.fontSize = '18px';
            break;
        case 'paragraph':
            element.innerHTML = '<p contenteditable="true">Your paragraph text goes here...</p>';
            element.style.fontSize = '14px';
            break;
        case 'image':
            element.innerHTML = '<div class="image-placeholder"><i class="fas fa-image fa-2x"></i><br><small>Click to upload image</small></div>';
            element.style.width = '200px';
            element.style.height = '150px';
            element.style.border = '2px dashed #ccc';
            element.style.display = 'flex';
            element.style.alignItems = 'center';
            element.style.justifyContent = 'center';
            element.style.flexDirection = 'column';
            break;
        case 'date':
            element.innerHTML = '<div class="date-element"><i class="fas fa-calendar me-2"></i><span contenteditable="true">Event Date</span></div>';
            break;
        case 'time':
            element.innerHTML = '<div class="time-element"><i class="fas fa-clock me-2"></i><span contenteditable="true">Event Time</span></div>';
            break;
        case 'location':
            element.innerHTML = '<div class="location-element"><i class="fas fa-map-marker-alt me-2"></i><span contenteditable="true">Event Location</span></div>';
            break;
        case 'rsvp':
            element.innerHTML = '<button class="btn btn-primary">RSVP Now</button>';
            break;
    }
    
    // Add element controls
    element.innerHTML += `
        <div class="element-controls">
            <button class="btn btn-sm btn-outline-primary" onclick="editElement(${elementCounter})">
                <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" onclick="deleteElement(${elementCounter})">
                <i class="fas fa-trash"></i>
            </button>
        </div>
    `;
    
    // Make element draggable within canvas
    element.draggable = true;
    element.addEventListener('dragstart', function(e) {
        e.dataTransfer.setData('text/plain', 'move');
    });
    
    element.addEventListener('click', function() {
        selectElement(element);
    });
    
    canvas.appendChild(element);
    selectElement(element);
}

function selectElement(element) {
    // Remove previous selection
    document.querySelectorAll('.canvas-element').forEach(el => {
        el.classList.remove('selected');
    });
    
    // Select new element
    element.classList.add('selected');
    selectedElement = element;
    
    // Update properties panel
    updatePropertiesPanel(element);
}

function updatePropertiesPanel(element) {
    const propertiesPanel = document.getElementById('element-properties');
    const type = element.dataset.type;
    const elementType = element.dataset.element;
    
    let propertiesHTML = `
        <div class="property-group">
            <label class="form-label">Element Type</label>
            <p class="form-control-plaintext">${elementType}</p>
        </div>
    `;
    
    if (type === 'text') {
        propertiesHTML += `
            <div class="property-group">
                <label class="form-label">Text Content</label>
                <textarea class="form-control" rows="2" onchange="updateElementProperty('text', this.value)">${element.textContent}</textarea>
            </div>
            <div class="property-group">
                <label class="form-label">Font Size</label>
                <input type="number" class="form-control" value="${parseInt(element.style.fontSize) || 16}" onchange="updateElementProperty('fontSize', this.value + 'px')">
            </div>
            <div class="property-group">
                <label class="form-label">Text Color</label>
                <input type="color" class="form-control form-control-color" value="${element.style.color || '#000000'}" onchange="updateElementProperty('color', this.value)">
            </div>
        `;
    }
    
    propertiesHTML += `
        <div class="property-group">
            <label class="form-label">Position</label>
            <div class="row">
                <div class="col-6">
                    <input type="number" class="form-control" placeholder="X" value="${parseInt(element.style.left) || 0}" onchange="updateElementProperty('left', this.value + 'px')">
                </div>
                <div class="col-6">
                    <input type="number" class="form-control" placeholder="Y" value="${parseInt(element.style.top) || 0}" onchange="updateElementProperty('top', this.value + 'px')">
                </div>
            </div>
        </div>
    `;
    
    propertiesPanel.innerHTML = propertiesHTML;
}

function updateElementProperty(property, value) {
    if (selectedElement) {
        selectedElement.style[property] = value;
    }
}

function editElement(elementId) {
    const element = document.querySelector(`[data-id="${elementId}"]`);
    if (element) {
        selectElement(element);
        // Open modal for detailed editing
        const modal = new bootstrap.Modal(document.getElementById('elementModal'));
        modal.show();
    }
}

function deleteElement(elementId) {
    const element = document.querySelector(`[data-id="${elementId}"]`);
    if (element) {
        element.remove();
        selectedElement = null;
        document.getElementById('element-properties').innerHTML = '<p class="text-muted text-center">Select an element to edit its properties</p>';
    }
}

function loadTemplate(templateType) {
    const canvas = document.getElementById('editor-canvas');
    canvas.innerHTML = '';
    
    // Create template elements based on type
    switch (templateType) {
        case 'wedding':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'subheading', 50, 100);
            createElement('event', 'date', 50, 150);
            createElement('event', 'time', 50, 200);
            createElement('event', 'location', 50, 250);
            createElement('event', 'rsvp', 50, 300);
            break;
        case 'birthday':
            createElement('text', 'heading', 50, 50);
            createElement('text', 'paragraph', 50, 100);
            createElement('event', 'date', 50, 200);
            createElement('event', 'rsvp', 50, 250);
            break;
    }
}

function zoomIn() {
    currentZoom += 25;
    updateZoom();
}

function zoomOut() {
    currentZoom = Math.max(25, currentZoom - 25);
    updateZoom();
}

function updateZoom() {
    const canvas = document.getElementById('editor-canvas');
    canvas.style.transform = `scale(${currentZoom / 100})`;
    document.querySelector('.zoom-level').textContent = currentZoom + '%';
}

function previewInvitation() {
    // Create preview modal or redirect to preview page
    alert('Preview functionality would open here');
}

function saveInvitation() {
    // Save the current design
    alert('Save functionality would save the invitation here');
}

function undo() {
    // Implement undo functionality
    console.log('Undo');
}

function redo() {
    // Implement redo functionality
    console.log('Redo');
}

function initializeCanvas() {
    // Set initial canvas size
    const canvas = document.getElementById('editor-canvas');
    canvas.style.width = '600px';
    canvas.style.height = '800px';
    canvas.style.border = '1px solid #ddd';
    canvas.style.position = 'relative';
    canvas.style.background = '#ffffff';
    canvas.style.margin = '0 auto';
}
</script>

<style>
.editor-sidebar, .properties-sidebar {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 1.5rem;
    height: calc(100vh - 200px);
    overflow-y: auto;
}

.sidebar-title, .properties-title {
    color: var(--primary-color);
    font-weight: 600;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid var(--accent-color);
}

.element-category {
    margin-bottom: 1.5rem;
}

.element-category h6 {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.draggable-elements {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0.5rem;
}

.draggable-element {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
    border: 2px solid var(--border-color);
    border-radius: 0.5rem;
    cursor: grab;
    transition: all 0.3s ease;
    background: white;
}

.draggable-element:hover {
    border-color: var(--primary-color);
    background: var(--bg-light);
    transform: translateY(-2px);
}

.draggable-element.dragging {
    opacity: 0.5;
    transform: rotate(5deg);
}

.draggable-element i {
    font-size: 1.5rem;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.draggable-element span {
    font-size: 0.8rem;
    color: var(--text-secondary);
    text-align: center;
}

.template-thumbnails {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.template-thumb {
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.template-thumb:hover {
    transform: scale(1.05);
}

.template-thumb img {
    width: 100%;
    height: 80px;
    object-fit: cover;
    border-radius: 0.5rem;
    border: 2px solid var(--border-color);
}

.template-thumb span {
    display: block;
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

.editor-canvas-container {
    background: white;
    border-radius: 0.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 1rem;
}

.canvas-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0.5rem;
    background: var(--bg-light);
    border-radius: 0.5rem;
}

.toolbar-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.zoom-level {
    font-weight: 500;
    color: var(--text-secondary);
    min-width: 50px;
    text-align: center;
}

.editor-canvas {
    border: 2px dashed var(--border-color);
    border-radius: 0.5rem;
    min-height: 600px;
    position: relative;
    background: white;
    margin: 0 auto;
}

.canvas-drop-zone {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    min-height: 600px;
}

.drop-zone-content {
    text-align: center;
    color: var(--text-light);
}

.canvas-element {
    border: 2px solid transparent;
    border-radius: 0.25rem;
    padding: 0.5rem;
    cursor: move;
    transition: all 0.3s ease;
    background: white;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.canvas-element:hover {
    border-color: var(--accent-color);
}

.canvas-element.selected {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(16, 19, 87, 0.2);
}

.element-controls {
    position: absolute;
    top: -10px;
    right: -10px;
    display: none;
    gap: 0.25rem;
}

.canvas-element:hover .element-controls,
.canvas-element.selected .element-controls {
    display: flex;
}

.image-placeholder {
    color: var(--text-light);
    text-align: center;
}

.property-group {
    margin-bottom: 1rem;
}

.property-group .form-label {
    font-size: 0.9rem;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 0.5rem;
}

.design-controls .control-group {
    margin-bottom: 1rem;
}

.drag-over {
    background: rgba(16, 19, 87, 0.1) !important;
    border-color: var(--primary-color) !important;
}
</style>
{% endblock %}
