{% extends "base.html" %}

{% block title %}Create Invitation - EventCraft Pro{% endblock %}

{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* Progress Bar - Exact Match from Images */
    .progress-bar-container {
        max-width: 1000px;
        margin: 0 auto 40px;
        padding: 0 20px;
    }

    .progress-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        position: relative;
    }

    .progress-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
        position: relative;
        z-index: 2;
    }

    .progress-step::after {
        content: '';
        position: absolute;
        top: 20px;
        left: 60%;
        right: -40%;
        height: 3px;
        background: #E5E5E5;
        z-index: 1;
    }

    .progress-step:last-child::after {
        display: none;
    }

    .progress-step.completed::after,
    .progress-step.active::after {
        background: linear-gradient(90deg, var(--reddish-brown-dark) 0%, var(--golden-yellow) 100%);
    }

    .step-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 16px;
        margin-bottom: 8px;
        position: relative;
        z-index: 2;
        transition: all 0.3s ease;
    }

    .progress-step.completed .step-circle {
        background: var(--reddish-brown-dark);
        color: white;
    }

    .progress-step.active .step-circle {
        background: var(--golden-yellow);
        color: white;
    }

    .progress-step.pending .step-circle {
        background: #E5E5E5;
        color: #999;
    }

    .step-label {
        font-size: 14px;
        font-weight: 500;
        color: var(--text-dark);
        text-align: center;
    }

    .progress-step.active .step-label {
        color: var(--reddish-brown-dark);
        font-weight: 600;
    }

    /* Page Container */
    .create-page-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
        background: var(--bg-cream);
        min-height: 100vh;
    }

    /* Page Title */
    .page-title {
        text-align: center;
        margin-bottom: 50px;
    }

    .page-title h1 {
        font-size: 48px;
        font-weight: 700;
        margin-bottom: 10px;
    }

    .page-title h1 .title-normal {
        color: var(--reddish-brown-dark);
    }

    .page-title h1 .title-gradient {
        background: linear-gradient(135deg, var(--reddish-brown-dark) 0%, var(--golden-yellow) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .page-title p {
        font-size: 18px;
        color: var(--text-gray);
    }

    /* Theme Selection Page */
    .theme-selection-page {
        display: none;
    }

    .theme-selection-page.active {
        display: block;
    }

    .theme-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 30px;
        max-width: 1000px;
        margin: 0 auto;
    }

    .theme-card {
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        border: 3px solid transparent;
    }

    .theme-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 16px 40px rgba(160, 120, 120, 0.2);
    }

    .theme-card.selected {
        border-color: var(--reddish-brown-dark);
    }

    .theme-card.selected::before {
        content: '✓';
        position: absolute;
        top: 12px;
        right: 12px;
        width: 28px;
        height: 28px;
        background: var(--reddish-brown-dark);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 16px;
        z-index: 3;
    }

    .theme-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }

    .theme-title {
        padding: 20px;
        text-align: center;
        font-size: 18px;
        font-weight: 600;
        color: var(--text-dark);
    }

    /* Details Form with Live Preview */
    .details-form-page {
        display: none;
    }

    .details-form-page.active {
        display: block;
    }

    .form-preview-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 40px;
        max-width: 1200px;
        margin: 0 auto;
    }

    /* Form Section */
    .form-section-card {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    }

    .form-group {
        margin-bottom: 24px;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 8px;
    }

    .form-label.required::after {
        content: ' *';
        color: var(--reddish-brown-dark);
    }

    .form-input,
    .form-textarea {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #E5E5E5;
        border-radius: 12px;
        font-size: 15px;
        transition: all 0.3s ease;
        font-family: 'Inter', sans-serif;
    }

    .form-input:focus,
    .form-textarea:focus {
        outline: none;
        border-color: var(--reddish-brown-dark);
        box-shadow: 0 0 0 4px rgba(160, 120, 120, 0.1);
    }

    .form-textarea {
        resize: vertical;
        min-height: 120px;
    }

    .input-with-icon {
        position: relative;
    }

    .input-with-icon i {
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-gray);
        pointer-events: none;
    }

    /* Live Preview Section */
    .live-preview-card {
        background: white;
        border-radius: 20px;
        padding: 40px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        position: sticky;
        top: 40px;
        height: fit-content;
        max-height: calc(100vh - 80px);
        overflow-y: auto;
    }

    .preview-title {
        font-size: 18px;
        font-weight: 600;
        color: var(--text-dark);
        margin-bottom: 24px;
        padding-bottom: 12px;
        border-bottom: 2px solid #E5E5E5;
    }

    .preview-content {
        text-align: center;
        padding: 40px 20px;
    }

    .preview-icon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.6;
    }

    .preview-event-name {
        font-size: 24px;
        font-weight: 700;
        color: var(--reddish-brown-dark);
        margin-bottom: 16px;
    }

    .preview-placeholder {
        color: var(--text-gray);
        font-size: 14px;
    }

    /* Navigation Buttons */
    .form-navigation {
        display: flex;
        justify-content: space-between;
        max-width: 1200px;
        margin: 40px auto 0;
        padding: 0 20px;
    }

    .btn-back,
    .btn-continue,
    .btn-preview {
        padding: 14px 32px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 16px;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: 2px solid;
        text-decoration: none;
        cursor: pointer;
    }

    .btn-back {
        background: white;
        color: var(--reddish-brown-dark);
        border-color: var(--reddish-brown-dark);
    }

    .btn-back:hover {
        background: #F8F8F8;
        transform: translateY(-2px);
    }

    .btn-continue,
    .btn-preview {
        background: linear-gradient(135deg, var(--reddish-brown-dark) 0%, var(--golden-yellow) 100%);
        color: white;
        border: none;
    }

    .btn-continue:hover,
    .btn-preview:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(160, 120, 120, 0.3);
    }

    /* Responsive */
    @media (max-width: 968px) {
        .form-preview-container {
            grid-template-columns: 1fr;
        }

        .live-preview-card {
            position: static;
            margin-top: 40px;
        }

        .theme-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 640px) {
        .theme-grid {
            grid-template-columns: 1fr;
        }

        .progress-bar {
            flex-wrap: wrap;
        }

        .progress-step {
            margin-bottom: 20px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="create-page-container">
    <!-- Progress Bar -->
    <div class="progress-bar-container">
        <div class="progress-bar">
            <div class="progress-step completed" data-step="1">
                <div class="step-circle">✓</div>
                <div class="step-label">Occasion</div>
            </div>
            <div class="progress-step active" data-step="2">
                <div class="step-circle">2</div>
                <div class="step-label">Theme</div>
            </div>
            <div class="progress-step pending" data-step="3">
                <div class="step-circle">3</div>
                <div class="step-label">Details</div>
            </div>
            <div class="progress-step pending" data-step="4">
                <div class="step-circle">4</div>
                <div class="step-label">Preview</div>
            </div>
        </div>
    </div>

    <!-- Theme Selection Page -->
    {% if not selected_template %}
    <div class="theme-selection-page active" id="themeSelectionPage">
        <div class="page-title">
            <h1>
                <span class="title-normal">Pick Your </span>
                <span class="title-gradient">Perfect Theme</span>
            </h1>
            <p>Select a design that speaks to your style</p>
        </div>

        <div class="theme-grid">
            {% for theme in available_themes %}
            <div class="theme-card" data-theme="{{ theme.id }}" onclick="selectTheme('{{ theme.id }}')">
                <img src="{{ theme.image_url }}" alt="{{ theme.name }}" class="theme-image">
                <div class="theme-title">{{ theme.name }}</div>
            </div>
            {% endfor %}
        </div>

        <div class="form-navigation">
            <a href="{{ url_for('templates') }}" class="btn-back">
                <i class="fas fa-arrow-left"></i> Back
            </a>
            <button class="btn-continue" id="continueToDetails" disabled>
                Continue <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
    {% endif %}

    <!-- Details Form Page -->
    <div class="details-form-page {% if selected_template %}active{% endif %}" id="detailsFormPage">
        <div class="page-title">
            <h1>
                <span class="title-normal">Add Your </span>
                <span class="title-gradient">Special Details</span>
            </h1>
            <p>Watch your invitation come to life</p>
        </div>

        <div class="form-preview-container">
            <!-- Form Section -->
            <div class="form-section-card">
                <form id="invitationForm" method="POST" action="{{ url_for('create_invitation') }}" enctype="multipart/form-data">
                    <input type="hidden" name="selectedTemplate" value="{{ selected_template }}" id="selectedTemplate">
                    
                    <div class="form-group">
                        <label class="form-label required">Event Name</label>
                        <input type="text" class="form-input" id="eventName" name="eventTitle" 
                               placeholder="e.g., Sarah & James or Emma's Sweet 16"
                               value="{% if current_user and selected_template %}{{ current_user.name }}'s Birthday{% endif %}">
                    </div>

                    <div class="form-group">
                        <label class="form-label required">Event Date</label>
                        <div class="input-with-icon">
                            <input type="date" class="form-input" id="eventDate" name="eventDate">
                            <i class="fas fa-calendar"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Event Time</label>
                        <div class="input-with-icon">
                            <input type="time" class="form-input" id="eventTime" name="eventTime" placeholder="---">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Venue Name</label>
                        <input type="text" class="form-input" id="venueName" name="venueName" 
                               placeholder="e.g., Garden Estate">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Venue Address</label>
                        <input type="text" class="form-input" id="venueAddress" name="venueAddress" 
                               placeholder="e.g., 123 Main St, City, State">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Hosted By</label>
                        <input type="text" class="form-input" id="hostedBy" name="hostName" 
                               placeholder="e.g., The Smith Family"
                               value="{{ current_user.name if current_user else '' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">RSVP Contact</label>
                        <input type="text" class="form-input" id="rsvpContact" name="contactEmail" 
                               placeholder="e.g., email@example.com or (555) 123-4567"
                               value="{{ current_user.email if current_user else '' }}">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Personal Message</label>
                        <textarea class="form-textarea" id="personalMessage" name="eventDescription" 
                                  rows="4" placeholder="Add a heartfelt message to your guests..."></textarea>
                    </div>
                </form>
            </div>

            <!-- Live Preview Section -->
            <div class="live-preview-card">
                <div class="preview-title">Live Preview</div>
                <div class="preview-content">
                    <div class="preview-icon">🎂</div>
                    <div class="preview-event-name" id="previewEventName">
                        Your Event Name
                    </div>
                    <div class="preview-placeholder" id="previewPlaceholder">
                        Start filling the form to see your invitation preview
                    </div>
                </div>
            </div>
        </div>

        <div class="form-navigation">
            <button class="btn-back" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
            <button class="btn-preview" onclick="submitForm()">
                Preview <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
</div>

<script>
    // Live Preview Updates
    document.addEventListener('DOMContentLoaded', function() {
        const eventNameInput = document.getElementById('eventName');
        const previewEventName = document.getElementById('previewEventName');
        const previewPlaceholder = document.getElementById('previewPlaceholder');

        // Update preview as user types
        eventNameInput.addEventListener('input', function() {
            const value = this.value.trim();
            if (value) {
                previewEventName.textContent = value;
                previewPlaceholder.style.display = 'none';
            } else {
                previewEventName.textContent = 'Your Event Name';
                previewPlaceholder.style.display = 'block';
            }
        });

        // Theme Selection
        window.selectTheme = function(themeId) {
            // Remove previous selection
            document.querySelectorAll('.theme-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Mark selected
            event.currentTarget.closest('.theme-card').classList.add('selected');
            
            // Enable continue button
            document.getElementById('continueToDetails').disabled = false;
            document.getElementById('selectedTemplate').value = themeId;
        };

        // Continue to Details
        document.getElementById('continueToDetails')?.addEventListener('click', function() {
            document.getElementById('themeSelectionPage').classList.remove('active');
            document.getElementById('detailsFormPage').classList.add('active');
            
            // Update progress bar
            updateProgressBar(3);
        });

        // Update Progress Bar
        function updateProgressBar(step) {
            document.querySelectorAll('.progress-step').forEach((stepEl, index) => {
                const stepNum = index + 1;
                if (stepNum < step) {
                    stepEl.classList.remove('active', 'pending');
                    stepEl.classList.add('completed');
                    stepEl.querySelector('.step-circle').textContent = '✓';
                } else if (stepNum === step) {
                    stepEl.classList.remove('completed', 'pending');
                    stepEl.classList.add('active');
                } else {
                    stepEl.classList.remove('active', 'completed');
                    stepEl.classList.add('pending');
                }
            });
        }

        // Form submission
        window.submitForm = function() {
            document.getElementById('invitationForm').submit();
        };

        window.goBack = function() {
            if (document.getElementById('themeSelectionPage')) {
                document.getElementById('themeSelectionPage').classList.add('active');
                document.getElementById('detailsFormPage').classList.remove('active');
                updateProgressBar(2);
            } else {
                window.history.back();
            }
        };
    });
</script>
{% endblock %}

