{% extends "base.html" %}

{% block title %}Edit Invitation - EventCraft Pro{% endblock %}

{% block extra_head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
    /* Edit Page Container */
    .edit-invitation-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    /* Edit Header */
    .edit-header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px 0;
    }

    .edit-header h1 {
        font-size: 36px;
        font-weight: 700;
        color: var(--text-dark) !important;
        margin-bottom: 10px;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
    }

    .edit-header p {
        font-size: 18px;
        color: var(--text-secondary) !important;
        opacity: 0.9;
    }

    /* Two Column Layout */
    .edit-form-preview-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 32px;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Form Section - White background for readability */
    .edit-form-section-card {
        background: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(10px) !important;
        -webkit-backdrop-filter: blur(10px) !important;
        border-radius: 20px;
        padding: 32px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(240, 240, 240, 0.8);
    }

    .form-section {
        margin-bottom: 32px;
    }

    .section-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 24px;
        padding-bottom: 12px;
        border-bottom: 2px solid rgba(111, 78, 55, 0.1);
    }

    .section-header i {
        font-size: 24px;
        color: var(--reddish-brown-dark);
    }

    .section-header h3 {
        font-size: 22px;
        font-weight: 700;
        color: var(--text-dark) !important;
        margin: 0;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group.full-width {
        grid-column: 1 / -1;
    }

    .form-label {
        display: block;
        font-size: 14px;
        font-weight: 600;
        color: var(--text-dark) !important;
        margin-bottom: 8px;
        letter-spacing: -0.01em;
        visibility: visible !important;
        opacity: 1 !important;
    }

    .form-label.required::after {
        content: ' *';
        color: var(--reddish-brown-dark);
    }

    .form-input,
    .form-textarea {
        width: 100%;
        padding: 12px 16px;
        border: 1.5px solid #E5E5E5;
        border-radius: 10px;
        font-size: 15px;
        transition: all 0.2s ease;
        font-family: 'Inter', sans-serif;
        background: rgba(255, 255, 255, 0.9) !important;
        backdrop-filter: blur(5px) !important;
        -webkit-backdrop-filter: blur(5px) !important;
        color: var(--text-dark) !important;
        visibility: visible !important;
        opacity: 1 !important;
    }

    .form-input:hover,
    .form-textarea:hover {
        border-color: rgba(160, 120, 120, 0.3);
        background: rgba(255, 255, 255, 1) !important;
    }

    .form-input:focus,
    .form-textarea:focus {
        outline: none;
        border-color: var(--reddish-brown-dark);
        background: rgba(255, 255, 255, 1) !important;
        box-shadow: 0 0 0 3px rgba(160, 120, 120, 0.08);
    }

    .form-input:not(:placeholder-shown),
    .form-textarea:not(:placeholder-shown) {
        background: rgba(255, 255, 255, 1) !important;
    }

    .form-group.has-content {
        background: rgba(255, 255, 255, 0.7) !important;
        backdrop-filter: blur(5px) !important;
        -webkit-backdrop-filter: blur(5px) !important;
        padding: 12px;
        border-radius: 10px;
        margin-bottom: 16px;
    }

    .form-textarea {
        resize: vertical;
        min-height: 120px;
    }

    .form-text {
        font-size: 13px;
        color: var(--text-secondary) !important;
        margin-top: 6px;
        visibility: visible !important;
        opacity: 1 !important;
    }

    /* Style Selection Grid */
    .style-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 16px;
        margin-top: 16px;
    }

    .style-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
        border: 2px solid #E5E5E5;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.9);
    }

    .style-option:hover {
        border-color: var(--reddish-brown-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(111, 78, 55, 0.15);
    }

    .style-option.selected {
        border-color: var(--reddish-brown-dark);
        background: rgba(111, 78, 55, 0.05);
        box-shadow: 0 4px 12px rgba(111, 78, 55, 0.2);
    }

    .style-option .emoji {
        font-size: 32px;
        margin-bottom: 8px;
    }

    .style-option .label {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-dark) !important;
    }

    /* Live Preview Section */
    .live-preview-card {
        background: rgba(255, 255, 255, 0.98) !important;
        backdrop-filter: blur(10px) !important;
        -webkit-backdrop-filter: blur(10px) !important;
        border-radius: 20px;
        padding: 32px;
        display: flex !important;
        flex-direction: column;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15) !important;
        border: 2px solid rgba(111, 78, 55, 0.2) !important;
        position: sticky;
        top: 20px;
        height: fit-content;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
        z-index: 10;
        visibility: visible !important;
        opacity: 1 !important;
    }

    .preview-title {
        font-size: 20px;
        font-weight: 700;
        color: var(--text-dark) !important;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid rgba(111, 78, 55, 0.1);
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
    }

    .preview-content {
        display: flex !important;
        visibility: visible !important;
        opacity: 1 !important;
        flex-direction: column;
    }

    .invitation-preview {
        max-width: 500px;
        min-height: 600px;
        margin: 0 auto;
        background: #FFFFFF;
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        display: flex !important;
        flex-direction: column;
        visibility: visible !important;
        opacity: 1 !important;
        overflow: visible;
    }

    .invitation-preview.template-bg {
        background-image: var(--template-bg-image-url, none);
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-color: transparent;
    }

    /* Action Buttons */
    .action-buttons {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 32px;
        padding-top: 24px;
        border-top: 2px solid rgba(111, 78, 55, 0.1);
    }

    .btn {
        padding: 12px 24px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 15px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: all 0.3s ease;
        border: none;
        cursor: pointer;
        visibility: visible !important;
        opacity: 1 !important;
    }

    .btn-secondary {
        background: #6c757d;
        color: #FFFFFF;
    }

    .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
    }

    .btn-success {
        background: linear-gradient(135deg, #6F4E37 0%, #D4AF37 100%);
        color: #FFFFFF;
        box-shadow: 0 4px 15px rgba(111, 78, 55, 0.3);
    }

    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(111, 78, 55, 0.4);
    }

    .preview-btn {
        background: linear-gradient(135deg, #42A5F5 0%, #1E88E5 100%);
        color: #FFFFFF;
        box-shadow: 0 4px 15px rgba(66, 165, 245, 0.3);
    }

    .preview-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(66, 165, 245, 0.4);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
        .edit-form-preview-container {
            grid-template-columns: 1fr;
            gap: 24px;
        }

        .live-preview-card {
            position: relative;
            top: 0;
            max-height: none;
        }
    }

    @media (max-width: 768px) {
        .edit-header h1 {
            font-size: 28px;
        }

        .edit-header p {
            font-size: 16px;
        }

        .form-grid {
            grid-template-columns: 1fr;
        }

        .style-grid {
            grid-template-columns: repeat(2, 1fr);
        }

        .action-buttons {
            flex-direction: column;
            gap: 16px;
        }

        .action-buttons > div {
            width: 100%;
        }

        .action-buttons .btn {
            width: 100%;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="edit-invitation-container">
    <!-- Edit Header -->
    <div class="edit-header">
        <h1>Edit Invitation</h1>
        <p>Update your invitation details and see changes instantly</p>
    </div>

    <form method="POST" action="{{ url_for('edit_invitation', invitation_id=invitation.id) }}" enctype="multipart/form-data">
        <div class="edit-form-preview-container">
            <!-- Form Section -->
            <div class="edit-form-section-card">
                <!-- Basic Event Information -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Basic Event Information</h3>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Event Title</label>
                            <input type="text" class="form-input" id="eventTitle" name="eventTitle" 
                                   value="{{ invitation.title or '' }}" placeholder="e.g., Sarah & John's Wedding" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label required">Event Date</label>
                            <input type="date" class="form-input" id="eventDate" name="eventDate" 
                                   value="{{ invitation.event_date.strftime('%Y-%m-%d') if invitation.event_date else '' }}" required>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Event Description</label>
                        <textarea class="form-textarea" id="eventDescription" name="eventDescription" rows="4" 
                                  placeholder="Describe your event, add special instructions, or include a personal message...">{{ invitation.description or '' }}</textarea>
                    </div>

                    <!-- Love Story Section for Weddings -->
                    {% if invitation.event_type == 'wedding' %}
                    <div class="form-group full-width">
                        <label class="form-label">Love Story</label>
                        <textarea class="form-textarea" id="loveStory" name="loveStory" rows="4" 
                                  placeholder="Share your beautiful love story...">{{ invitation.love_story or '' }}</textarea>
                        <small class="form-text">Your beautiful love story will be featured in the invitation!</small>
                    </div>
                    {% endif %}

                    <!-- Event Story Section for Other Events -->
                    {% if invitation.event_type != 'wedding' %}
                    <div class="form-group full-width">
                        <label class="form-label">Event Story</label>
                        <textarea class="form-textarea" id="eventStory" name="eventStory" rows="4" 
                                  placeholder="Share your event story...">{{ invitation.event_story or '' }}</textarea>
                        <small class="form-text">Your event story will add a personal touch to the invitation!</small>
                    </div>
                    {% endif %}
                </div>

                <!-- Style Selection -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-palette"></i>
                        <h3>Event Style (Optional)</h3>
                    </div>
                    
                    <p class="form-text">
                        Choose a style that matches your event theme, or leave unselected for a neutral design
                    </p>
                    
                    <div class="style-grid">
                        <div class="style-option {% if invitation.event_style == 'hindu' %}selected{% endif %}" onclick="selectStyle('hindu', this)">
                            <span class="emoji">üïâÔ∏è</span>
                            <span class="label">Hindu</span>
                            <input type="radio" name="eventStyle" value="hindu" {% if invitation.event_style == 'hindu' %}checked{% endif %} style="display: none;">
                        </div>
                        
                        <div class="style-option {% if invitation.event_style == 'muslim' %}selected{% endif %}" onclick="selectStyle('muslim', this)">
                            <span class="emoji">‚ò™Ô∏è</span>
                            <span class="label">Muslim</span>
                            <input type="radio" name="eventStyle" value="muslim" {% if invitation.event_style == 'muslim' %}checked{% endif %} style="display: none;">
                        </div>
                        
                        <div class="style-option {% if invitation.event_style == 'christian' %}selected{% endif %}" onclick="selectStyle('christian', this)">
                            <span class="emoji">‚úùÔ∏è</span>
                            <span class="label">Christian</span>
                            <input type="radio" name="eventStyle" value="christian" {% if invitation.event_style == 'christian' %}checked{% endif %} style="display: none;">
                        </div>
                        
                        <div class="style-option {% if invitation.event_style == 'general' or not invitation.event_style %}selected{% endif %}" onclick="selectStyle('general', this)">
                            <span class="emoji">üåç</span>
                            <span class="label">General</span>
                            <input type="radio" name="eventStyle" value="general" {% if invitation.event_style == 'general' or not invitation.event_style %}checked{% endif %} style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Event-Specific Information -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-star"></i>
                        <h3>Event-Specific Details</h3>
                    </div>
                    
                    {% if invitation.event_type == 'wedding' %}
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Bride's Name</label>
                            <input type="text" class="form-input" id="brideName" name="brideName" 
                                   value="{{ invitation.bride_name or '' }}" placeholder="Bride's full name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Groom's Name</label>
                            <input type="text" class="form-input" id="groomName" name="groomName" 
                                   value="{{ invitation.groom_name or '' }}" placeholder="Groom's full name">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Muhurtham Time</label>
                            <input type="time" class="form-input" id="muhurthamTime" name="muhurthamTime" 
                                   value="{{ invitation.muhurtham_time or '' }}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Reception Time</label>
                            <input type="time" class="form-input" id="receptionTime" name="receptionTime" 
                                   value="{{ invitation.reception_time or '' }}">
                        </div>
                    </div>
                    {% elif invitation.event_type == 'birthday' %}
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Birthday Person's Name</label>
                            <input type="text" class="form-input" id="birthdayPerson" name="birthdayPerson" 
                                   value="{{ invitation.birthday_person or '' }}" placeholder="Name of the birthday person">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Age</label>
                            <input type="number" class="form-input" id="age" name="age" 
                                   value="{{ invitation.age or '' }}" placeholder="Age" min="1" max="120">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Start Time</label>
                            <input type="time" class="form-input" id="startTime" name="startTime" 
                                   value="{{ invitation.start_time or '' }}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dinner Time</label>
                            <input type="time" class="form-input" id="dinnerTime" name="dinnerTime" 
                                   value="{{ invitation.dinner_time or '' }}">
                        </div>
                    </div>
                    {% elif invitation.event_type == 'babyshower' %}
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Mother's Name</label>
                            <input type="text" class="form-input" id="motherName" name="motherName" 
                                   value="{{ invitation.mother_name or '' }}" placeholder="Expecting mother's name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Father's Name</label>
                            <input type="text" class="form-input" id="fatherName" name="fatherName" 
                                   value="{{ invitation.father_name or '' }}" placeholder="Expecting father's name">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Start Time</label>
                            <input type="time" class="form-input" id="babyshowerStartTime" name="babyshowerStartTime" 
                                   value="{{ invitation.babyshower_start_time or '' }}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">End Time</label>
                            <input type="time" class="form-input" id="babyshowerEndTime" name="babyshowerEndTime" 
                                   value="{{ invitation.babyshower_end_time or '' }}">
                        </div>
                    </div>
                    {% elif invitation.event_type == 'graduation' %}
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Graduate's Name</label>
                            <input type="text" class="form-input" id="graduateName" name="graduateName" 
                                   value="{{ invitation.graduate_name or '' }}" placeholder="Graduate's full name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Degree</label>
                            <input type="text" class="form-input" id="degree" name="degree" 
                                   value="{{ invitation.degree or '' }}" placeholder="e.g., Bachelor's Degree">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">School/University</label>
                            <input type="text" class="form-input" id="school" name="school" 
                                   value="{{ invitation.school or '' }}" placeholder="School or university name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Field of Study</label>
                            <input type="text" class="form-input" id="major" name="major" 
                                   value="{{ invitation.major or '' }}" placeholder="e.g., Computer Science">
                        </div>
                    </div>
                    {% elif invitation.event_type == 'anniversary' %}
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Couple's Names</label>
                            <input type="text" class="form-input" id="coupleNames" name="coupleNames" 
                                   value="{{ invitation.couple_names or '' }}" placeholder="e.g., Sarah & John">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Years of Marriage</label>
                            <input type="number" class="form-input" id="marriageYears" name="marriageYears" 
                                   value="{{ invitation.marriage_years or '' }}" placeholder="e.g., 25" min="1" max="100">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Dinner Time</label>
                            <input type="time" class="form-input" id="anniversaryDinnerTime" name="anniversaryDinnerTime" 
                                   value="{{ invitation.anniversary_dinner_time or '' }}">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Party Time</label>
                            <input type="time" class="form-input" id="partyTime" name="partyTime" 
                                   value="{{ invitation.party_time or '' }}">
                        </div>
                    </div>
                    {% elif invitation.event_type == 'retirement' %}
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Retiring Person's Name</label>
                            <input type="text" class="form-input" id="honoreeName" name="honoreeName" 
                                   value="{{ invitation.honoree_name or '' }}" placeholder="Full name of the retiring person">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Position/Title</label>
                            <input type="text" class="form-input" id="position" name="position" 
                                   value="{{ invitation.position or '' }}" placeholder="e.g., Senior Manager">
                        </div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Company/Organization</label>
                            <input type="text" class="form-input" id="company" name="company" 
                                   value="{{ invitation.company or '' }}" placeholder="Company or organization name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Career Start Year</label>
                            <input type="number" class="form-input" id="startYear" name="startYear" 
                                   value="{{ invitation.start_year or '' }}" placeholder="e.g., 1985" min="1900" max="2024">
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Contact Information -->
                <div class="form-section">
                    <div class="section-header">
                        <i class="fas fa-address-book"></i>
                        <h3>Contact Information</h3>
                    </div>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label required">Host Name</label>
                            <input type="text" class="form-input" id="hostName" name="hostName" 
                                   value="{{ invitation.host_name or '' }}" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Contact Phone</label>
                            <input type="tel" class="form-input" id="contactPhone" name="contactPhone" 
                                   value="{{ invitation.contact_phone or '' }}" placeholder="Phone number for inquiries">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Contact Email</label>
                            <input type="email" class="form-input" id="contactEmail" name="contactEmail" 
                                   value="{{ invitation.contact_email or '' }}" placeholder="Email for inquiries">
                        </div>
                        
                        <div class="form-group full-width">
                            <label class="form-label">Venue Address</label>
                            <textarea class="form-textarea" id="venueAddress" name="venueAddress" rows="3" 
                                      placeholder="Enter the venue address...">{{ invitation.venue_address or '' }}</textarea>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <div>
                        <a href="{{ url_for('view_invitation_manage', share_url=invitation.share_url) }}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i>
                            Back to Manage
                        </a>
                    </div>
                    
                    <div style="display: flex; gap: 1rem;">
                        <a href="{{ url_for('view_invitation_final', share_url=invitation.share_url) }}" class="btn preview-btn" target="_blank">
                            <i class="fas fa-eye"></i>
                            Preview
                        </a>
                        
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i>
                            Save Changes
                        </button>
                    </div>
                </div>
            </div>

            <!-- Live Preview Section -->
            <div class="live-preview-card" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
                <div class="preview-title" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
                    <i class="fas fa-eye me-2"></i>Live Preview
                </div>
                <div class="preview-content" style="display: flex !important; visibility: visible !important; opacity: 1 !important;">
                    <div class="invitation-preview {% if invitation.template_image_url %}template-bg{% endif %}" 
                         id="invitationPreviewCard"
                         style="display: flex !important; visibility: visible !important; opacity: 1 !important;"
                         {% if invitation.template_image_url %}data-template-image="{{ invitation.template_image_url|e }}"{% endif %}
                         data-event-type="{{ invitation.event_type or ''|e }}">
                        <!-- Preview content will be populated by JavaScript -->
                        <div id="previewPlaceholder" style="text-align: center; padding: 40px; color: #6F4E37;">
                            <i class="fas fa-magic" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
                            <p style="font-size: 16px; opacity: 0.7;">Your invitation preview will appear here</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
// Style selection
function selectStyle(style, element) {
    document.querySelectorAll('.style-option').forEach(opt => opt.classList.remove('selected'));
    element.classList.add('selected');
    element.querySelector('input[type="radio"]').checked = true;
    updateLivePreview();
}

// Update live preview function - Comprehensive
function updateLivePreview() {
    const previewCard = document.getElementById('invitationPreviewCard');
    if (!previewCard) return;

    // Get all form values
    const eventTitle = document.getElementById('eventTitle')?.value || '';
    const eventDate = document.getElementById('eventDate')?.value || '';
    const eventDescription = document.getElementById('eventDescription')?.value || '';
    const loveStory = document.getElementById('loveStory')?.value || '';
    const eventStory = document.getElementById('eventStory')?.value || '';
    const hostName = document.getElementById('hostName')?.value || '';
    const contactPhone = document.getElementById('contactPhone')?.value || '';
    const contactEmail = document.getElementById('contactEmail')?.value || '';
    const venueAddress = document.getElementById('venueAddress')?.value || '';
    
    // Event-specific fields
    const eventType = previewCard.dataset.eventType || '';
    let eventSpecificHTML = '';
    
    if (eventType === 'wedding') {
        const brideName = document.getElementById('brideName')?.value || '';
        const groomName = document.getElementById('groomName')?.value || '';
        const muhurthamTime = document.getElementById('muhurthamTime')?.value || '';
        const receptionTime = document.getElementById('receptionTime')?.value || '';
        
        if (brideName || groomName) {
            eventSpecificHTML += `<div class="preview-bride-groom" style="font-size: 20px; font-weight: 600; color: #6F4E37; margin: 20px 0; text-align: center;">
                ${brideName}${brideName && groomName ? ' & ' : ''}${groomName}
            </div>`;
        }
        if (muhurthamTime) {
            eventSpecificHTML += `<p style="font-size: 14px; color: #6F4E37; margin-bottom: 8px; text-align: center;"><i class="fas fa-clock me-2"></i>Muhurtham: ${muhurthamTime}</p>`;
        }
        if (receptionTime) {
            eventSpecificHTML += `<p style="font-size: 14px; color: #6F4E37; margin-bottom: 16px; text-align: center;"><i class="fas fa-clock me-2"></i>Reception: ${receptionTime}</p>`;
        }
    } else if (eventType === 'birthday') {
        const birthdayPerson = document.getElementById('birthdayPerson')?.value || '';
        const age = document.getElementById('age')?.value || '';
        const startTime = document.getElementById('startTime')?.value || '';
        const dinnerTime = document.getElementById('dinnerTime')?.value || '';
        
        if (birthdayPerson) {
            eventSpecificHTML += `<div class="preview-birthday-person" style="font-size: 20px; font-weight: 600; color: #6F4E37; margin: 20px 0; text-align: center;">
                ${birthdayPerson}${age ? ` - ${age} Years` : ''}
            </div>`;
        }
        if (startTime) {
            eventSpecificHTML += `<p style="font-size: 14px; color: #6F4E37; margin-bottom: 8px; text-align: center;"><i class="fas fa-clock me-2"></i>Start: ${startTime}</p>`;
        }
        if (dinnerTime) {
            eventSpecificHTML += `<p style="font-size: 14px; color: #6F4E37; margin-bottom: 16px; text-align: center;"><i class="fas fa-clock me-2"></i>Dinner: ${dinnerTime}</p>`;
        }
    } else if (eventType === 'anniversary') {
        const coupleNames = document.getElementById('coupleNames')?.value || '';
        const marriageYears = document.getElementById('marriageYears')?.value || '';
        const dinnerTime = document.getElementById('anniversaryDinnerTime')?.value || '';
        const partyTime = document.getElementById('partyTime')?.value || '';
        
        if (coupleNames) {
            eventSpecificHTML += `<div class="preview-couple-names" style="font-size: 20px; font-weight: 600; color: #6F4E37; margin: 20px 0; text-align: center;">
                ${coupleNames}${marriageYears ? ` - ${marriageYears} Years` : ''}
            </div>`;
        }
        if (dinnerTime) {
            eventSpecificHTML += `<p style="font-size: 14px; color: #6F4E37; margin-bottom: 8px; text-align: center;"><i class="fas fa-clock me-2"></i>Dinner: ${dinnerTime}</p>`;
        }
        if (partyTime) {
            eventSpecificHTML += `<p style="font-size: 14px; color: #6F4E37; margin-bottom: 16px; text-align: center;"><i class="fas fa-clock me-2"></i>Party: ${partyTime}</p>`;
        }
    }
    
    // Hide placeholder if there's content
    const placeholder = document.getElementById('previewPlaceholder');
    if (placeholder && (eventTitle || eventDate || eventDescription || eventSpecificHTML)) {
        placeholder.style.display = 'none';
    } else if (placeholder) {
        placeholder.style.display = 'block';
    }

    // Build preview HTML
    let previewHTML = '';
    
    if (eventTitle) {
        previewHTML += `<h2 class="preview-event-name" style="font-size: 28px; font-weight: 700; color: #6F4E37; margin-bottom: 16px; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);">${eventTitle}</h2>`;
    }
    
    // Event-specific content
    if (eventSpecificHTML) {
        previewHTML += eventSpecificHTML;
    }
    
    if (eventDate) {
        const dateObj = new Date(eventDate);
        const formattedDate = dateObj.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        previewHTML += `<p class="preview-date-time" style="font-size: 16px; color: #6F4E37; margin-bottom: 12px; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);"><i class="fas fa-calendar me-2"></i>${formattedDate}</p>`;
    }
    
    if (loveStory) {
        previewHTML += `<div class="preview-message" style="font-size: 14px; color: #6F4E37; margin: 20px 0; padding: 16px; background: rgba(255, 255, 255, 0.7); border-radius: 8px; line-height: 1.6; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);">${loveStory}</div>`;
    } else if (eventStory) {
        previewHTML += `<div class="preview-message" style="font-size: 14px; color: #6F4E37; margin: 20px 0; padding: 16px; background: rgba(255, 255, 255, 0.7); border-radius: 8px; line-height: 1.6; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);">${eventStory}</div>`;
    } else if (eventDescription) {
        previewHTML += `<div class="preview-message" style="font-size: 14px; color: #6F4E37; margin: 20px 0; padding: 16px; background: rgba(255, 255, 255, 0.7); border-radius: 8px; line-height: 1.6; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);">${eventDescription}</div>`;
    }
    
    if (venueAddress) {
        previewHTML += `<p class="preview-venue" style="font-size: 14px; color: #6F4E37; margin: 16px 0; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);"><i class="fas fa-map-marker-alt me-2"></i>${venueAddress}</p>`;
    }
    
    if (hostName || contactPhone || contactEmail) {
        previewHTML += `<div style="margin-top: 24px; padding-top: 16px; border-top: 1px solid rgba(111, 78, 55, 0.2);">`;
        if (hostName) {
            previewHTML += `<p class="preview-hosted" style="font-size: 14px; color: #6F4E37; margin-bottom: 8px; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);"><i class="fas fa-user me-2"></i>Hosted by ${hostName}</p>`;
        }
        if (contactPhone) {
            previewHTML += `<p style="font-size: 13px; color: #6F4E37; margin-bottom: 8px; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);"><i class="fas fa-phone me-2"></i>${contactPhone}</p>`;
        }
        if (contactEmail) {
            previewHTML += `<p style="font-size: 13px; color: #6F4E37; margin-bottom: 8px; text-align: center; text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);"><i class="fas fa-envelope me-2"></i>${contactEmail}</p>`;
        }
        previewHTML += `</div>`;
    }

    // Update preview card (preserve background if exists)
    if (previewHTML) {
        const currentBg = previewCard.style.backgroundImage;
        previewCard.innerHTML = previewHTML;
        if (currentBg) {
            previewCard.style.backgroundImage = currentBg;
        }
    }
}

// Initialize form and preview
document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    const eventDateInput = document.getElementById('eventDate');
    if (eventDateInput) {
        eventDateInput.min = today;
    }

    // Add event listeners to all form inputs for live preview
    const formInputs = document.querySelectorAll('.form-input, .form-textarea');
    formInputs.forEach(input => {
        input.addEventListener('input', updateLivePreview);
        input.addEventListener('change', updateLivePreview);
    });

    // Initial preview update
    updateLivePreview();

    // Update template background if exists
    const previewCard = document.getElementById('invitationPreviewCard');
    if (previewCard && previewCard.dataset.templateImage) {
        const templateImage = previewCard.dataset.templateImage;
        previewCard.style.backgroundImage = `url('${templateImage}')`;
        previewCard.style.backgroundSize = 'cover';
        previewCard.style.backgroundPosition = 'center';
        previewCard.style.backgroundRepeat = 'no-repeat';
    }
});
</script>
{% endblock %}
