{% extends "base.html" %}

{% block title %}Pick a Template - EventCraft Pro{% endblock %}

{% block content %}
<style>
/* Template Card Styles */
.template-card {
    background: white;
    border-radius: 15px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    height: 100%;
    border: 1px solid #e9ecef;
}

.template-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.template-content {
    background: white;
}

.template-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.template-description {
    font-size: 0.9rem;
    color: #6c757d;
    line-height: 1.4;
}

.template-tags {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.tag {
    background: #f8f9fa;
    color: #495057;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 500;
    border: 1px solid #e9ecef;
}

.template-icon {
    color: #007bff;
    font-size: 1.5rem;
}

.template-actions .btn {
    border-radius: 8px;
    font-weight: 500;
    padding: 0.75rem 1rem;
}

/* Text Visibility Fixes */
.hero-title {
    color: #2c3e50 !important;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
    font-weight: 700;
}

.hero-subtitle {
    color: #495057 !important;
    font-weight: 500;
    line-height: 1.6;
}

.templates-hero {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    position: relative;
}

.templates-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    z-index: 1;
}

.templates-hero .container {
    position: relative;
    z-index: 2;
}

/* Lottie2 Image Animation Styles */
.lottie-hero-container {
    position: relative;
    height: 400px;
    display: flex;
    justify-content: center;
    align-items: center;
    perspective: 1200px;
    perspective-origin: center center;
}

.lottie-image-container {
    position: relative;
    transform-style: preserve-3d;
    animation: image-float-3d 8s ease-in-out infinite;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.lottie-image-container:hover {
    animation-play-state: paused;
    transform: rotateY(15deg) rotateX(5deg) scale(1.1);
}

.hero-lottie-image {
    width: 350px;
    height: auto;
    border-radius: 20px;
    box-shadow: 
        0 20px 40px rgba(0,0,0,0.15),
        0 0 0 1px rgba(255,255,255,0.1),
        inset 0 1px 0 rgba(255,255,255,0.2);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    filter: 
        drop-shadow(0 10px 20px rgba(0,0,0,0.2))
        brightness(1.05)
        contrast(1.1)
        saturate(1.1);
    transform: translateZ(20px);
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    image-rendering: pixelated;
}

.hero-lottie-image:hover {
    transform: translateZ(40px) rotateY(10deg) rotateX(5deg) scale(1.05);
    box-shadow: 
        0 30px 60px rgba(0,0,0,0.25),
        0 0 0 2px rgba(255,255,255,0.2),
        inset 0 2px 0 rgba(255,255,255,0.3);
    filter: 
        drop-shadow(0 15px 30px rgba(0,0,0,0.3))
        brightness(1.1)
        contrast(1.15)
        saturate(1.2);
}

.lottie-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-radius: 20px;
    pointer-events: none;
}

.floating-elements {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
}

.floating-element {
    position: absolute;
    font-size: 2rem;
    animation: float-around-3d 6s ease-in-out infinite;
    opacity: 0.8;
    filter: 
        drop-shadow(0 4px 8px rgba(0,0,0,0.2))
        brightness(1.2);
    transform-style: preserve-3d;
    transition: all 0.3s ease;
}

.floating-element:hover {
    transform: scale(1.3) rotateY(180deg) translateZ(20px);
    opacity: 1;
    filter: 
        drop-shadow(0 6px 12px rgba(0,0,0,0.3))
        brightness(1.4);
}

.element-1 {
    top: 10%;
    left: 10%;
    animation-delay: 0s;
}

.element-2 {
    top: 20%;
    right: 15%;
    animation-delay: 1s;
}

.element-3 {
    bottom: 20%;
    left: 20%;
    animation-delay: 2s;
}

.element-4 {
    bottom: 15%;
    right: 25%;
    animation-delay: 3s;
}

.element-5 {
    top: 15%;
    left: 25%;
    animation-delay: 4s;
}

/* Enhanced 3D Animations */
@keyframes image-float-3d {
    0% { 
        transform: translateY(0px) rotateY(0deg) rotateX(0deg) scale(1) translateZ(0px); 
    }
    25% { 
        transform: translateY(-15px) rotateY(5deg) rotateX(2deg) scale(1.02) translateZ(10px); 
    }
    50% { 
        transform: translateY(-25px) rotateY(0deg) rotateX(0deg) scale(1.05) translateZ(20px); 
    }
    75% { 
        transform: translateY(-15px) rotateY(-5deg) rotateX(-2deg) scale(1.02) translateZ(10px); 
    }
    100% { 
        transform: translateY(0px) rotateY(0deg) rotateX(0deg) scale(1) translateZ(0px); 
    }
}

@keyframes float-around-3d {
    0%, 100% { 
        transform: translateY(0px) rotate(0deg) scale(1) translateZ(0px);
        opacity: 0.6;
    }
    25% { 
        transform: translateY(-20px) rotate(90deg) scale(1.2) translateZ(15px);
        opacity: 0.9;
    }
    50% { 
        transform: translateY(-30px) rotate(180deg) scale(1.1) translateZ(25px);
        opacity: 1;
    }
    75% { 
        transform: translateY(-15px) rotate(270deg) scale(1.3) translateZ(10px);
        opacity: 0.8;
    }
}
</style>

<!-- Templates Hero Section -->
<section class="templates-hero py-5 bg-light">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-6">
                <h1 class="hero-title display-4 fw-bold mb-3" style="color: #2c3e50;">All Available Templates</h1>
                <p class="hero-subtitle lead" style="color: #495057;">Browse and filter through our complete collection of invitation templates.</p>
            </div>
            <div class="col-lg-6">
                <div class="lottie-container">
                    <div class="lottie-hero-container">
                        <div class="lottie-image-container">
                            <img src="/images/lottie2.jpg" alt="EventCraft Templates" class="hero-lottie-image">
                            <div class="lottie-overlay"></div>
                            
                            <!-- Floating Background Elements -->
                            <div class="floating-elements">
                                <div class="floating-element element-1">üé®</div>
                                <div class="floating-element element-2">‚ú®</div>
                                <div class="floating-element element-3">üéâ</div>
                                <div class="floating-element element-4">üíù</div>
                                <div class="floating-element element-5">üåü</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Templates Section with Filters -->
<section class="templates-section py-5">
    <div class="container">
        <div class="row">
            <!-- Filters Sidebar -->
            <div class="col-lg-3">
                <div class="filters-sidebar">
                    <div class="filters-header d-flex justify-content-between align-items-center mb-4">
                        <h5 class="fw-bold mb-0">Filters</h5>
                        <a href="#" class="text-decoration-none text-primary clear-filters">Clear Filters</a>
                    </div>
                    
                    <!-- Event Type Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="filter-title fw-bold mb-3">Event Type</h6>
                        <div class="filter-options">
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="wedding" id="filter-wedding">
                                <label class="form-check-label" for="filter-wedding">
                                    Wedding
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="birthday" id="filter-birthday">
                                <label class="form-check-label" for="filter-birthday">
                                    Birthday Party
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="anniversary" id="filter-anniversary">
                                <label class="form-check-label" for="filter-anniversary">
                                    Anniversary
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="babyshower" id="filter-babyshower">
                                <label class="form-check-label" for="filter-babyshower">
                                    Baby Shower
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="graduation" id="filter-graduation">
                                <label class="form-check-label" for="filter-graduation">
                                    Graduation Party
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="retirement" id="filter-retirement">
                                <label class="form-check-label" for="filter-retirement">
                                    Retirement Party
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Style Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="filter-title fw-bold mb-3">Style</h6>
                        <div class="filter-options">
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="traditional" id="filter-traditional">
                                <label class="form-check-label" for="filter-traditional">
                                    Traditional
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="modern" id="filter-modern">
                                <label class="form-check-label" for="filter-modern">
                                    Modern
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="elegant" id="filter-elegant">
                                <label class="form-check-label" for="filter-elegant">
                                    Elegant
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="fun" id="filter-fun">
                                <label class="form-check-label" for="filter-fun">
                                    Fun & Colorful
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="classic" id="filter-classic">
                                <label class="form-check-label" for="filter-classic">
                                    Classic
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Theme Filter -->
                    <div class="filter-group mb-4">
                        <h6 class="filter-title fw-bold mb-3">Theme</h6>
                        <div class="filter-options">
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="hindu" id="filter-hindu">
                                <label class="form-check-label" for="filter-hindu">
                                    Hindu
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="muslim" id="filter-muslim">
                                <label class="form-check-label" for="filter-muslim">
                                    Muslim
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="christian" id="filter-christian">
                                <label class="form-check-label" for="filter-christian">
                                    Christian
                                </label>
                            </div>
                            <div class="form-check mb-2">
                                <input class="form-check-input filter-check-input" type="checkbox" value="secular" id="filter-secular">
                                <label class="form-check-label" for="filter-secular">
                                    Secular
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Templates Grid -->
            <div class="col-lg-9">
                <!-- Search and Sort Bar -->
                <div class="templates-controls mb-4">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <div class="search-box">
                                <div class="input-group">
                                    <span class="input-group-text bg-white border-end-0">
                                        <i class="fas fa-search text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-start-0" id="template-search" placeholder="Search templates...">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex justify-content-end gap-3">
                                <div class="sort-dropdown">
                                    <select class="form-select" id="sort-templates">
                                        <option value="popular">Most Popular</option>
                                        <option value="newest">Newest First</option>
                                        <option value="alphabetical">A-Z</option>
                                        <option value="event-type">Event Type</option>
                                    </select>
                                </div>
                                <div class="view-toggle">
                                    <button class="btn btn-outline-secondary active" id="grid-view" title="Grid View">
                                        <i class="fas fa-th"></i>
                                    </button>
                                    <button class="btn btn-outline-secondary" id="list-view" title="List View">
                                        <i class="fas fa-list"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Results Counter -->
                <div class="results-info mb-3">
                    <span class="text-muted">Showing <span id="results-count">8</span> templates</span>
                </div>
                
                <div class="templates-grid">
                    <div class="row g-4" id="templates-container">
                        <!-- Wedding Templates -->
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="wedding" data-style="elegant" data-theme="secular">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/wedding.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-heart text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Wedding Elegant</h4>
                                    <p class="template-description text-muted mb-3">Perfect for your special day</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Wedding</span>
                                        <span class="tag">Elegant</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=wedding_elegant" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="wedding" data-style="traditional" data-theme="hindu">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/hindutraditional.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-om text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Wedding Hindu Traditional</h4>
                                    <p class="template-description text-muted mb-3">Sacred Hindu ceremony design</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Wedding</span>
                                        <span class="tag">Hindu</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=wedding_hindu_traditional" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="wedding" data-style="elegant" data-theme="muslim">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/muslimelegant.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-moon text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Wedding Muslim Elegant</h4>
                                    <p class="template-description text-muted mb-3">Beautiful Islamic wedding design</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Wedding</span>
                                        <span class="tag">Muslim</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=wedding_muslim_elegant" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Birthday Templates -->
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="birthday" data-style="fun" data-theme="secular">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/birthday.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-birthday-cake text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Birthday Fun Colorful</h4>
                                    <p class="template-description text-muted mb-3">Celebrate in style</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Birthday</span>
                                        <span class="tag">Fun</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=birthday_fun_colorful" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Anniversary Templates -->
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="anniversary" data-style="elegant" data-theme="secular">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/anniversery.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-heart text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Anniversary Golden Elegant</h4>
                                    <p class="template-description text-muted mb-3">Celebrate love & memories</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Anniversary</span>
                                        <span class="tag">Golden</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=anniversary_golden_elegant" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Baby Shower Templates -->
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="babyshower" data-style="fun" data-theme="secular">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/babyshower.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-baby text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Baby Shower Sweet Pink</h4>
                                    <p class="template-description text-muted mb-3">Welcome the little one</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Baby Shower</span>
                                        <span class="tag">Sweet</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=babyshower_sweet_pink" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Graduation Templates -->
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="graduation" data-style="modern" data-theme="secular">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/graduation.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-graduation-cap text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Graduation Success Modern</h4>
                                    <p class="template-description text-muted mb-3">Celebrate academic achievements</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Graduation</span>
                                        <span class="tag">Modern</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=graduation_success_modern" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Retirement Templates -->
                        <div class="col-lg-4 col-md-6 template-item" data-event-type="retirement" data-style="classic" data-theme="secular">
                            <div class="template-card">
                                <div class="template-preview" style="background-image: url('/images/retirement.jpg'); background-size: cover; background-position: center; height: 250px; border-radius: 15px 15px 0 0;">
                                </div>
                                <div class="template-content p-3">
                                    <div class="template-icon mb-2">
                                        <i class="fas fa-chair text-primary"></i>
                                    </div>
                                    <h4 class="template-title mb-2">Retirement Golden Classic</h4>
                                    <p class="template-description text-muted mb-3">Honor years of service</p>
                                    <div class="template-tags mb-3">
                                        <span class="tag">Retirement</span>
                                        <span class="tag">Classic</span>
                                    </div>
                                    <div class="template-actions">
                                        <a href="{{ url_for('create_invitation') }}?template=retirement_golden_classic" class="btn btn-primary w-100">
                                            Choose Template
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Bottom Action Buttons -->
<section class="bottom-actions py-4 bg-light">
    <div class="container">
        <div class="d-flex justify-content-end gap-3">
            <a href="#" class="btn btn-secondary-custom">Choose Later</a>
            <a href="{{ url_for('create_invitation') }}" class="btn btn-primary-custom">Use this template</a>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
// Enhanced Filter and Search functionality
document.addEventListener('DOMContentLoaded', function() {
    const filterCheckboxes = document.querySelectorAll('.filter-check-input');
    const templateItems = document.querySelectorAll('.template-item');
    const clearFiltersLink = document.querySelector('.clear-filters');
    const searchInput = document.getElementById('template-search');
    const sortSelect = document.getElementById('sort-templates');
    const gridViewBtn = document.getElementById('grid-view');
    const listViewBtn = document.getElementById('list-view');
    const resultsCount = document.getElementById('results-count');
    const templatesContainer = document.getElementById('templates-container');
    
    let currentView = 'grid';
    
    // Function to apply filters and search
    function applyFilters() {
        const searchTerm = searchInput.value.toLowerCase();
        const selectedEventTypes = Array.from(document.querySelectorAll('input[value*="wedding"]:checked, input[value*="birthday"]:checked, input[value*="anniversary"]:checked, input[value*="babyshower"]:checked, input[value*="graduation"]:checked, input[value*="retirement"]:checked')).map(cb => cb.value);
        const selectedStyles = Array.from(document.querySelectorAll('input[value*="traditional"]:checked, input[value*="modern"]:checked, input[value*="elegant"]:checked, input[value*="fun"]:checked, input[value*="classic"]:checked')).map(cb => cb.value);
        const selectedThemes = Array.from(document.querySelectorAll('input[value*="hindu"]:checked, input[value*="muslim"]:checked, input[value*="christian"]:checked, input[value*="secular"]:checked')).map(cb => cb.value);
        
        let visibleCount = 0;
        
        templateItems.forEach(item => {
            const eventType = item.dataset.eventType;
            const style = item.dataset.style;
            const theme = item.dataset.theme;
            const title = item.querySelector('.template-title').textContent.toLowerCase();
            const description = item.querySelector('.template-description').textContent.toLowerCase();
            const tags = Array.from(item.querySelectorAll('.tag')).map(tag => tag.textContent.toLowerCase()).join(' ');
            
            const eventTypeMatch = selectedEventTypes.length === 0 || selectedEventTypes.includes(eventType);
            const styleMatch = selectedStyles.length === 0 || selectedStyles.includes(style);
            const themeMatch = selectedThemes.length === 0 || selectedThemes.includes(theme);
            const searchMatch = searchTerm === '' || title.includes(searchTerm) || description.includes(searchTerm) || tags.includes(searchTerm);
            
            if (eventTypeMatch && styleMatch && themeMatch && searchMatch) {
                item.style.display = 'block';
                visibleCount++;
            } else {
                item.style.display = 'none';
            }
        });
        
        // Update results count
        resultsCount.textContent = visibleCount;
        
        // Apply sorting
        applySorting();
    }
    
    // Function to apply sorting
    function applySorting() {
        const sortValue = sortSelect.value;
        const visibleItems = Array.from(templateItems).filter(item => item.style.display !== 'none');
        
        visibleItems.sort((a, b) => {
            const titleA = a.querySelector('.template-title').textContent;
            const titleB = b.querySelector('.template-title').textContent;
            
            switch(sortValue) {
                case 'alphabetical':
                    return titleA.localeCompare(titleB);
                case 'newest':
                    // For demo purposes, reverse alphabetical order
                    return titleB.localeCompare(titleA);
                case 'event-type':
                    const eventTypeA = a.dataset.eventType;
                    const eventTypeB = b.dataset.eventType;
                    return eventTypeA.localeCompare(eventTypeB);
                case 'popular':
                default:
                    // Keep original order for popular
                    return 0;
            }
        });
        
        // Reorder elements in DOM
        visibleItems.forEach(item => {
            templatesContainer.appendChild(item);
        });
    }
    
    // Add event listeners
    filterCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', applyFilters);
    });
    
    searchInput.addEventListener('input', applyFilters);
    sortSelect.addEventListener('change', applySorting);
    
    // Clear filters functionality
    clearFiltersLink.addEventListener('click', function(e) {
        e.preventDefault();
        filterCheckboxes.forEach(checkbox => {
            checkbox.checked = false;
        });
        searchInput.value = '';
        applyFilters();
    });
    
    // View toggle functionality
    gridViewBtn.addEventListener('click', function() {
        currentView = 'grid';
        gridViewBtn.classList.add('active');
        listViewBtn.classList.remove('active');
        templatesContainer.className = 'row g-4';
        templateItems.forEach(item => {
            item.className = 'col-lg-4 col-md-6 template-item';
        });
    });
    
    listViewBtn.addEventListener('click', function() {
        currentView = 'list';
        listViewBtn.classList.add('active');
        gridViewBtn.classList.remove('active');
        templatesContainer.className = 'row g-2';
        templateItems.forEach(item => {
            item.className = 'col-12 template-item';
        });
    });
    
    // Initialize filters - show all templates by default
    applyFilters();
});

// Intersection Observer for animations
const observerOptions = {
    threshold: 0.1,
    rootMargin: '0px 0px -50px 0px'
};

const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
        }
    });
}, observerOptions);

// Observe all template cards
document.querySelectorAll('.template-card').forEach(el => {
    observer.observe(el);
});
</script>
{% endblock %}

